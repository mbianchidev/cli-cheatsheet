#!/bin/bash

# get just the current folder stub/name
export PROJECT=${PWD##*/}
# set WHERE_TO if you have a preference, defaults to ~/node_cache/$PROJECT/node_modules
export WHERE_TO=${WHERE_TO:-$HOME/node_cache/$PROJECT}

echo "Moving $PROJECT node_modules to $WHERE_TO"

if [[ -L ./node_modules ]]; then
  echo "node_modules is already a symlink!"
  exit
fi

echo "creating folder"
mkdir -p $WHERE_TO                               # ensure this folder
echo "zipping node modules"
tar -vcf - node_modules| (cd $WHERE_TO; tar -vxf -)  # this efficiently replicates the folder structure
echo "renaming nome modules"
sudo mv node_modules node_modules_backup              # backup your old node_modules
echo "creating symlink"
# moving node_modules to 
ln -s $WHERE_TO/node_modules ./node_modules      # symlink to the ubuntu cache

echo "You can `rm -rf node_modules_backup` once your build works correctly!"

# this works but if you run npm --install it will re-install to the local folder
# to avoid it let's create a symlink to the ubuntu cache

